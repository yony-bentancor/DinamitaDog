{% extends "masterAdministrador.njk" %}
{% block main %}
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://dulce29.herokuapp.com/static/css/styleAdmin.css"/>
  <title>ESTADISTICAS</title>
  <script>
    /* When the user clicks on the button,
toggle between hiding and showing the dropdown content */
    function myFunction() {
      document
        .getElementById("myDropdown")
        .classList
        .toggle("show");
    }

    // Close the dropdown if the user clicks outside of it
    window.onclick = function (event) {
      if (!event.target.matches('.dropbtn')) {
        var dropdowns = document.getElementsByClassName("dropdown-content");
        var i;
        for (i = 0; i < dropdowns.length; i++) {
          var openDropdown = dropdowns[i];
          if (openDropdown.classList.contains('show')) {
            openDropdown
              .classList
              .remove('show');
          }
        }
      }
    }
  </script>

  <body>
    <div id="navbarAdministrador">
      <div class="row">
        <div class="col-12">
          <input type="checkbox" id="menu-toggle" class="menu-toggle">
          <label for="menu-toggle" class="menu-toggle-label">&#9776;</label>
          <ul class="menu">
            <li>
              <a href="/session/clientes">CLIENTES</a>
            </li>
            <li>
              <a href="/session/pendientes">PEDIDOS PENDIENTES</a>
            </li>
            <li>
              <a href="/session/realizados">PEDIDOS REALIZADOS</a>
            </li>
            <li>
              <a href="/session/entregados">PEDIDOS ENTREGADOS</a>
            </li>
            <li>
              <a href="/session/estadisticas">ESTADISTICAS</a>
            </li>
            <li>
              <a href="/session/productosAdmin">PRODUCTOS</a>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div id="contenedorEstadisticas">
      <div id="infoEstadisticas">
        <div class="row">
          <div class="col-12 clase9"> HISTOR√çCO </div>
        </div>

        <div  class="row catEstadisticas">
          <div class="col-1 "> TOTAL CLIENTES</div>
          <div class="col-1 ">  CLIENTES SIN PEDIDOS</div>
          <div class="col-1 "> TOTAL PEDIDOS </div>
          <div class="col-2 ">   PEDIDOS x CATEGORIA </div>
          <div class="col-1 "> PROMEDIO PEDIDOS CLIENTE </div>
          <div class="col-2 "> LITROS PRODUCIDOS </div>
          <div class="col-2 "> PRODUCTO + VENDIDO</div>
          <div class="col-2"> MES</div>
        </div>

        <div class="row datosEstadisticos">
          <div class="col-1">{{ contadorUser }}</div>
          <div class="col-1">{{clientesSinPedidos.length}}</div>
          <div  class="col-1">
            {{ contadorPedido }}</div>
          <div  class="col-1 pedidoCategoria">
            {% for resultado in resultados %}
              <li class="registro {{ resultado._id|lower }}">{{ resultado._id }}</li>
            {% endfor %}
            {#    {% for resultado in resultados %}
              {{ resultado._id }}

            {% endfor %} #}
          </div>
          <div  class="col-1 pedidoCategoriaValor">
            {% for resultado in resultadosValor %}

              {{ resultado.cantidadTotal }}
            {% endfor %}
          </div>

          <div class="col-1">{{ promedioPedidoClientetotal }}</div>
          <div class="col-2">
            <ul style="list-style: none;">
              <li class="listaDown">
                <text class="floatRight">{{sumarLitros}}</text>
              </li>
              <ul>
                {% for producto in output %}
                  {% set partes = producto.split(' ') %}
                  <li class="listaDown">{{ partes[0] }} - <text class="floatRight">{{ partes[1] }}</text>
                  </li>
                {% endfor %}
              </ul>
          </ul>

        </div>
        <div class="col-2 ">
          <ul style="list-style: none;">
            {% for item in output2 %}
              <li class="listaDown">{{ item }}</li>
            {% endfor %}
          </ul>
        </div>
        <div class="col-2">
          <form  action="estadisticasMes" method="POST">
                   Desde: <input type="date" name="fechaInicio">
                   Hasta: <input type="date" name="fechaFin">
            <button type="submit" class="sizeBtn">Buscar</button>
          </form>
        </div>

      </div>
      <div  class="row">
        <div class="col-12 clase99">POR MES </div>
      </div>

      <div class="row catEstadisticasMes">
        <div class="col-1">NUEVOS CLIENTES</div>

        <div class="col-2"> CLIENTES SIN PEDIDOS</div>
        <div class="col-1"> CLIENTES CON PEDIDOS</div>
        <div class="col-1">TOTAL PEDIDOS</div>
        <div class="col-1">PROMEDIO PEDIDO CLIENTE </div>
        <div class="col-2 ">PRODUCTOS X LITROS</div>
        <div class="col-2 ">MAS VENDIDO</div>
        <div class="col-2 mesBusqueda">
          {{mesEntrada}} /  {{mesSalida}}</div>
      </div>

      <div class="row datosEstadisticosMes">
        <div class="col-1 ">
          {{clientesRegistrados}}
        </div>
        {# <div id="nombresNoEnArray2" class="col-2"> #}
        <div class="col-2">
          {% for user in nombresNoEnArray2 %}
            <li class="listaDown">{{ user.username }} -   
              <a href="https://api.whatsapp.com/send?phone={{ user.telefono }}" class="floatRight">{{ user.telefono }}</a>
            </li>
          {% endfor %}
        </div>
        <div class="col-1 ">
          {{restaUser}} DE {{ contadorUser }}
        </div>
        <div class="col-1 ">
          {{contadorPedidoXFecha}}
        </div>
        <div class="col-1 ">{{promedioPedidoClientexFechaT}}</div>
        <div class="col-2">
          <ul style="list-style: none;">
            <li class="listaDown">TOTAL EN LITROS<text class="floatRight">{{sumarLitrosxFecha}}</text>
            </li>
            <ul>
              {% for producto in outputxFecha %}
                {% set partes = producto.split(' ') %}
                <li class="listaDown">{{ partes[0] }} - <text class="floatRight">{{ partes[1] }}</text>
                </li>
              {% endfor %}
            </ul>
        </ul>

      </div>
      <div class="col-2 ">
        <ul style="list-style: none;">
          {% for item in output2xFecha %}
            <li class="listaDown">{{ item }}</li>
          {% endfor %}
        </ul>
      </div>
      <div class="col-2 "></div>
    </div>
  </div>

</div>
</div>

</body>

{% endblock %}